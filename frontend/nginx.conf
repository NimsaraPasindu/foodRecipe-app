# frontend/nginx.conf

# This file will be copied to /etc/nginx/conf.d/default.conf
# It should ONLY contain server blocks, as it's included within the main http context of NGINX.

server {
    listen 80; # Listen on port 80 inside the container
    server_name localhost; # Can be anything, useful for local testing

    # Primary root for index.html and general SPA fallbacks
    root /usr/share/nginx/html;

    # Ensure correct character set and standard MIME types
    charset utf-8;
    include /etc/nginx/mime.types;

    # Basic logging (optional, but good for debugging)
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log warn;

    # Main location block for Single Page Application (SPA) routing
    # This handles / and falls back to index.html for client-side routing
    location / {
        try_files $uri $uri/ /index.html;
    }

    # *** CRITICAL FIX: Explicitly handle the /assets/ directory ***
    # This location block will specifically match requests for files within /assets/
    # and ensures they are served directly from the correct path.
    location /assets/ {
        # Set the root for this specific location.
        # This tells NGINX to look for /usr/share/nginx/html/assets/ when /assets/something.js is requested.
        alias /usr/share/nginx/html/assets/;
        try_files $uri =404; 
        
        # Try to find the exact file requested, otherwise return a 404.
        # This prevents falling back to index.html for missing assets.
        try_files $uri =404; 

        # Explicitly set Content-Type for JavaScript files within /assets/
        location ~* \.js$ {
            add_header Content-Type "application/javascript";
            expires max; # Cache these files for a long time
            log_not_found off; # Don't log 404s if file truly isn't there
            add_header Cache-Control "public, max-age=31536000, immutable";
        }

        # Explicitly set Content-Type for CSS files within /assets/
        location ~* \.css$ {
            add_header Content-Type "text/css";
            expires max;
            log_not_found off;
            add_header Cache-Control "public, max-age=31536000, immutable";
        }

        # Explicit handling for other common static assets within /assets/
        location ~* \.(png|jpg|jpeg|gif|ico|woff|woff2|ttf|eot|svg|json)$ {
            expires max;
            log_not_found off;
            add_header Cache-Control "public, max-age=31536000, immutable";
        }
    }
}
